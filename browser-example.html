<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SITL Image Generation - Browser Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            resize: vertical;
            background: #f8f9fa;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        button:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .canvas-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        canvas {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        .info { color: #3498db; }
        
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .example-card {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-card:hover {
            background: #e9ecef;
            border-color: #3498db;
            transform: translateY(-2px);
        }
        
        .example-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .example-description {
            font-size: 14px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® SITL Image Generation</h1>
        <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">
            Generate images from Scene Instruction and Transformation Language (SITL) code
        </p>
        
        <div class="section">
            <h2>üìù SITL Code</h2>
            <div class="examples">
                <div class="example-card" onclick="loadExample('medical')">
                    <div class="example-title">Medical Scene</div>
                    <div class="example-description">Doctor-patient consultation in hospital room</div>
                </div>
                <div class="example-card" onclick="loadExample('office')">
                    <div class="example-title">Office Meeting</div>
                    <div class="example-description">Team meeting in modern conference room</div>
                </div>
                <div class="example-card" onclick="loadExample('family')">
                    <div class="example-title">Family Portrait</div>
                    <div class="example-description">Family gathering in living room</div>
                </div>
                <div class="example-card" onclick="loadExample('developer')">
                    <div class="example-title">Developer Workspace</div>
                    <div class="example-description">Programmer working at desk</div>
                </div>
            </div>
            
            <textarea id="sitlCode" placeholder="Enter your SITL code here...">scene "Developer Workspace" {
    environment {
        lighting: natural
        background: "modern home office"
        time: "afternoon"
        atmosphere: focused
    }

    human developer {
        age: 28
        gender: "non-binary"
        clothing: "comfortable hoodie"
        emotion: "focused"
        pose: "sitting at desk"
        accessories: ["laptop", "coffee mug", "headphones"]
    }

    object desk {
        type: "furniture"
        material: "wood"
        color: "oak"
        style: "minimalist"
    }

    object laptop {
        type: "electronics"
        brand: "modern"
        state: "open with code editor"
    }

    object coffee_mug {
        type: "drinkware"
        material: "ceramic"
        color: "blue"
        state: "half full"
    }

    position developer at center
    position desk at center
    position laptop on desk
    position coffee_mug on desk
}</textarea>
        </div>
        
        <div class="section">
            <h2>‚öôÔ∏è Configuration</h2>
            <div class="controls">
                <div class="control-group">
                    <label for="width">Canvas Width</label>
                    <input type="number" id="width" value="1024" min="100" max="4000">
                </div>
                <div class="control-group">
                    <label for="height">Canvas Height</label>
                    <input type="number" id="height" value="768" min="100" max="4000">
                </div>
                <div class="control-group">
                    <label for="quality">Rendering Quality</label>
                    <select id="quality">
                        <option value="low">Low (Fast)</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="ultra">Ultra (Slow)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="format">Export Format</label>
                    <select id="format">
                        <option value="png" selected>PNG</option>
                        <option value="jpeg">JPEG</option>
                        <option value="webp">WebP</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="exportQuality">Export Quality</label>
                    <input type="range" id="exportQuality" min="10" max="100" value="85">
                    <span id="qualityValue">85%</span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <button onclick="generateImage()" id="generateBtn">üöÄ Generate Image</button>
            <button onclick="clearOutput()" id="clearBtn">üóëÔ∏è Clear Output</button>
            <button onclick="downloadImage()" id="downloadBtn" disabled>üíæ Download Image</button>
        </div>
        
        <div class="section">
            <h2>üìä Output</h2>
            <div id="output" class="output">Ready to generate images from SITL code...</div>
        </div>
        
        <div class="section">
            <h2>üñºÔ∏è Generated Image</h2>
            <div class="canvas-container" id="canvasContainer">
                <p style="color: #7f8c8d;">Generated image will appear here</p>
            </div>
        </div>
    </div>

    <script type="module">
        console.log('üöÄ Starting SITL browser example...');
        
        try {
            console.log('üì¶ Importing SITLEngine...');
            const { SITLEngine } = await import('./dist/sitl-engine.js');
            console.log('‚úÖ SITLEngine imported successfully');
            
            let engine = null;
            let currentBlob = null;
        
        // Example SITL scenes
        const examples = {
            medical: `scene "Medical Consultation" {
    environment {
        lighting: bright_clinical
        background: "hospital examination room"
        time: "morning"
        atmosphere: professional
    }

    human doctor {
        age: 45
        gender: "female"
        clothing: "white coat with stethoscope"
        emotion: "confident"
        pose: "standing"
        accessories: ["clipboard", "pen"]
    }

    human patient {
        age: 30
        gender: "male"
        clothing: "casual shirt"
        emotion: "concerned"
        pose: "sitting"
    }

    object examination_table {
        type: "medical furniture"
        material: "steel and vinyl"
        color: "white"
    }

    object medical_chart {
        type: "document"
        position: "on wall"
    }

    position doctor at center_left
    position patient on examination_table
    position examination_table at center
    position medical_chart at background_wall
}`,
            office: `scene "Team Meeting" {
    environment {
        lighting: natural
        background: "modern conference room"
        time: "afternoon"
        atmosphere: professional
    }

    human manager {
        age: 40
        gender: "female"
        clothing: "business suit"
        emotion: "confident"
        pose: "standing"
        accessories: ["presentation remote"]
    }

    human developer {
        age: 28
        gender: "male"
        clothing: "casual shirt"
        emotion: "focused"
        pose: "sitting"
        accessories: ["laptop"]
    }

    object conference_table {
        type: "furniture"
        material: "glass and steel"
        color: "black"
    }

    object projector_screen {
        type: "electronics"
        state: "displaying presentation"
    }

    position manager at front
    position developer at conference_table
    position conference_table at center
    position projector_screen at background
}`,
            family: `scene "Family Portrait" {
    environment {
        lighting: warm
        background: "cozy living room"
        time: "evening"
        atmosphere: comfortable
    }

    human parent1 {
        age: 35
        gender: "female"
        clothing: "casual sweater"
        emotion: "happy"
        pose: "sitting on sofa"
    }

    human parent2 {
        age: 37
        gender: "male"
        clothing: "casual shirt"
        emotion: "happy"
        pose: "sitting on sofa"
    }

    human child {
        age: 8
        gender: "female"
        clothing: "colorful dress"
        emotion: "excited"
        pose: "standing between parents"
    }

    object sofa {
        type: "furniture"
        material: "fabric"
        color: "beige"
        style: "comfortable"
    }

    position parent1 on sofa_left
    position parent2 on sofa_right
    position child at center_front
    position sofa at center
}`,
            developer: `scene "Developer Workspace" {
    environment {
        lighting: natural
        background: "modern home office"
        time: "afternoon"
        atmosphere: focused
    }

    human developer {
        age: 28
        gender: "non-binary"
        clothing: "comfortable hoodie"
        emotion: "focused"
        pose: "sitting at desk"
        accessories: ["laptop", "coffee mug", "headphones"]
    }

    object desk {
        type: "furniture"
        material: "wood"
        color: "oak"
        style: "minimalist"
    }

    object laptop {
        type: "electronics"
        brand: "modern"
        state: "open with code editor"
    }

    object coffee_mug {
        type: "drinkware"
        material: "ceramic"
        color: "blue"
        state: "half full"
    }

    position developer at center
    position desk at center
    position laptop on desk
    position coffee_mug on desk
}`
        };
        
        // Global functions for HTML onclick handlers
        window.loadExample = function(type) {
            document.getElementById('sitlCode').value = examples[type];
            log(`üìñ Loaded ${type} example`, 'info');
        };
        
        window.generateImage = async function() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                await initializeEngine();
                await parseAndRender();
            } catch (error) {
                log(`üí• Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üöÄ Generate Image';
            }
        };
        
        window.clearOutput = function() {
            document.getElementById('output').textContent = 'Output cleared.';
            document.getElementById('canvasContainer').innerHTML = '<p style="color: #7f8c8d;">Generated image will appear here</p>';
            document.getElementById('downloadBtn').disabled = true;
            currentBlob = null;
        };
        
        window.downloadImage = function() {
            if (currentBlob) {
                const url = URL.createObjectURL(currentBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sitl-generated-${Date.now()}.${document.getElementById('format').value}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                log(`üíæ Downloaded image as ${a.download}`, 'success');
            }
        };
        
        // Update quality display
        document.getElementById('exportQuality').addEventListener('input', function() {
            document.getElementById('qualityValue').textContent = this.value + '%';
        });
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function initializeEngine() {
            if (engine) return;
            
            log('‚öôÔ∏è Initializing SITL engine...', 'info');
            
            const config = {
                canvas: {
                    width: parseInt(document.getElementById('width').value),
                    height: parseInt(document.getElementById('height').value),
                    backgroundColor: '#ffffff'
                },
                rendering: {
                    quality: document.getElementById('quality').value,
                    antialiasing: true
                },
                export: {
                    format: document.getElementById('format').value,
                    quality: parseInt(document.getElementById('exportQuality').value)
                }
            };
            
            engine = new SITLEngine(config);
            const result = await engine.initialize();
            
            if (result.success) {
                log('‚úÖ Engine initialized successfully', 'success');
            } else {
                throw new Error(`Engine initialization failed: ${result.errors?.join(', ')}`);
            }
        }
        
        async function parseAndRender() {
            const sitlCode = document.getElementById('sitlCode').value.trim();
            
            if (!sitlCode) {
                throw new Error('Please enter SITL code');
            }
            
            // Parse
            log('üìù Parsing SITL code...', 'info');
            const parseResult = await engine.parse(sitlCode);
            
            if (!parseResult.success || !parseResult.data) {
                throw new Error(`Parse failed: ${parseResult.errors?.join(', ')}`);
            }
            
            log(`‚úÖ Parsed scene: "${parseResult.data.name}"`, 'success');
            
            // Render
            log('üé® Rendering scene...', 'info');
            const renderOptions = {
                width: parseInt(document.getElementById('width').value),
                height: parseInt(document.getElementById('height').value),
                quality: document.getElementById('quality').value
            };
            
            const renderResult = await engine.render(parseResult.data, renderOptions);
            
            if (!renderResult.success || !renderResult.data) {
                throw new Error(`Render failed: ${renderResult.errors?.join(', ')}`);
            }
            
            log(`‚úÖ Scene rendered (${renderResult.data.width}x${renderResult.data.height})`, 'success');
            
            // Display canvas
            const canvasContainer = document.getElementById('canvasContainer');
            canvasContainer.innerHTML = '';
            canvasContainer.appendChild(renderResult.data);
            
            // Export
            log('üíæ Exporting image...', 'info');
            const exportOptions = {
                format: document.getElementById('format').value,
                quality: parseInt(document.getElementById('exportQuality').value),
                filename: `sitl-generated.${document.getElementById('format').value}`
            };
            
            const exportResult = await engine.export(renderResult.data, exportOptions);
            
            if (exportResult.success && exportResult.data) {
                currentBlob = exportResult.data;
                document.getElementById('downloadBtn').disabled = false;
                log(`üéâ Image exported successfully (${Math.round(exportResult.data.size / 1024)}KB)`, 'success');
            } else {
                throw new Error(`Export failed: ${exportResult.errors?.join(', ')}`);
            }
        }
        
            // Initialize on page load
            log('üéØ SITL Image Generator ready', 'info');
            log('üëÜ Click "Generate Image" to start', 'info');
            
        } catch (error) {
            console.error('‚ùå Failed to initialize SITL browser example:', error);
            document.body.innerHTML = `
                <div style="max-width: 800px; margin: 50px auto; padding: 20px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; color: #721c24;">
                    <h2>‚ùå Error Loading SITL Example</h2>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Please check the browser console for more details.</p>
                    <p>Make sure the SITL engine is properly built by running: <code>npm run build</code></p>
                </div>
            `;
        }
    </script>
</body>
</html>